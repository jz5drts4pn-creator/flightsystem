{% extends 'base.html' %}

{% block title %}My Bookings{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-4">My Bookings</h2>

{% if bookings %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {% for booking in bookings %}
    <div class="bg-white shadow-lg rounded-lg p-4 hover:shadow-2xl transition duration-300">
        <div class="flex justify-between items-center">
            <div>
                <h3 class="text-xl font-semibold">
                    {{ booking.flight.departure_airport.code }} â†’ {{ booking.flight.arrival_airport.code }}
                </h3>
                <p class="text-gray-600">
                    Departure: {{ booking.flight.departure_time|date:"M d, Y H:i" }} <br>
                    Arrival: {{ booking.flight.arrival_time|date:"M d, Y H:i" }} <br>
                    Aircraft: {{ booking.flight.aircraft.name }}
                </p>
            </div>
            <div class="text-right">
                <p class="text-lg font-bold">${{ booking.flight.price }}</p>
                <p class="text-sm text-gray-500">Seat: {{ booking.seat_number }}</p>
                <p class="text-xs text-gray-400">Booked at: {{ booking.booked_at|date:"M d, Y H:i" }}</p>
            </div>
        </div>
        <div class="mt-4 text-right">
            <form method="post" action="{% url 'cancel_booking' booking.id %}">
                {% csrf_token %}
                <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-500 transition">
                    Cancel Booking
                </button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
<!-- Cancel button triggers modal -->
<button onclick="openModal({{ booking.id }})" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-500">
    Cancel Booking
</button>

<!-- Modal -->
<div id="modal-{{ booking.id }}" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center">
    <div class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-bold mb-4">Confirm Cancellation</h2>
        <p>Are you sure you want to cancel this booking?</p>
        <div class="mt-4 flex justify-end space-x-2">
            <button onclick="closeModal({{ booking.id }})" class="px-4 py-2 bg-gray-300 rounded">No</button>
            <form method="post" action="{% url 'cancel_booking' booking.id %}">
                {% csrf_token %}
                <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded">Yes, Cancel</button>
            </form>
        </div>
    </div>
</div>

<script>
function openModal(id) {
    document.getElementById('modal-' + id).classList.remove('hidden');
    document.getElementById('modal-' + id).classList.add('flex');
}
function closeModal(id) {
    document.getElementById('modal-' + id).classList.remove('flex');
    document.getElementById('modal-' + id).classList.add('hidden');
}
</script>
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    <!-- flight cards -->
</div>
<div class="relative w-full h-64 md:h-80 lg:h-96 overflow-hidden">
    <img src="/static/images/plane.svg" class="plane absolute top-10 left-[-100px] w-20 md:w-24 lg:w-32"/>
</div>



{% else %}
<p class="text-gray-600">You have no bookings yet.</p>
{% endif %}

{% endblock %}
